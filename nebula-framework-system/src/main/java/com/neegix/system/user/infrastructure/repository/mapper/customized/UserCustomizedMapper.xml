<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!--
    This file is auto-generated by nebula-framework-generator.
    The auto-generation plugin was developed using IntelliJ IDEA Community Edition.
    Thanks to JetBrains for their outstanding contributions to the developer community.

    The code generated by this tool is owned by the user of the tool.
    The tool itself is copyrighted by https://www.neegix.com.

    @author https://www.neegix.com
    @version 1.0.0
    @since 2024-12-03 11:47:28
-->

<mapper namespace="com.neegix.system.user.infrastructure.repository.mapper.customized.UserCustomizedMapper">

    <!-- 根据Ids查询数量 -->
    <select id="selectCountByIds" resultType="java.lang.Long">
        select count(1) from sys_user
        <where>
            id in
            <foreach collection="list" item="id" index="index" open="(" close=")" separator=",">
                #{id, jdbcType=BIGINT}
            </foreach>
        </where>
    </select>

    <!--  批量删除人员角色关系  -->
    <delete id="deleteUserRoleRel" parameterType="java.lang.Long">
        delete from sys_user_role_rel
        <where>
            pk_user in
            <foreach collection="list" item="id" index="index" open="(" close=")" separator=",">
                #{id, jdbcType=BIGINT}
            </foreach>
        </where>
    </delete>


    <!-- 批量插入用户角色关系 -->
    <insert id="insertUserRoleRel" parameterType="java.util.List" useGeneratedKeys="false">
        INSERT INTO sys_user_role_rel (id, pk_user, pk_role)
        VALUES
        <foreach collection="list" item="userRoleRelDO" separator=",">
            (#{userRoleRelDO.id}, #{userRoleRelDO.pkUser}, #{userRoleRelDO.pkRole})
        </foreach>
    </insert>

    <!-- 根据用户查询角色 -->
    <select id="selectRolesByPkUser" parameterType="java.lang.Long" resultType="com.neegix.system.user.infrastructure.repository.dataobject.UserRoleDO">
        select
            sr.*
        from
            sys_user_role_rel surr
            left join sys_role sr on
            surr.pk_role = sr.id
        where surr.pk_user = #{pkUser, jdbcType=BIGINT}
    </select>

    <select id="selectUsers" resultType="com.neegix.system.user.interfaces.vo.UserForExportVO">
        select
            su.name,
            su.nick_name,
            su.description,
            sdi.name as user_type,
            su.email,
            su.mobile_phone
        from
            nebula.sys_user su
            left join nebula.sys_dict_item sdi on
            su.user_type = sdi.id
    </select>
</mapper>