<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!--
    This file is auto-generated by nebula-framework-generator.
    The auto-generation plugin was developed using IntelliJ IDEA Community Edition.
    Thanks to JetBrains for their outstanding contributions to the developer community.

    The code generated by this tool is owned by the user of the tool.
    The tool itself is copyrighted by https://www.neegix.com.

    @author https://www.neegix.com
    @version 1.0.0
    @since 2024-11-25 11:32:40
-->

<mapper namespace="com.neegix.system.role.infrastructure.repository.mapper.customized.RoleCustomizedMapper">

    <!-- 根据Ids查询数量 -->
    <select id="selectCountByIds" resultType="java.lang.Integer">
        select count(1) from sys_role
        <where>
            id in
            <foreach collection="list" item="id" index="index" open="(" close=")" separator=",">
                #{id, jdbcType=BIGINT}
            </foreach>
        </where>
    </select>

    <insert id="insertRoleApi">
        INSERT INTO sys_role_api_rel (pk_role, pk_api)
        VALUES
        <foreach collection="ids" item="pkApi" separator=",">
            (#{pkRole}, #{pkApi})
        </foreach>
    </insert>

    <insert id="insertRoleMenu">
        INSERT INTO sys_role_menu_rel ( pk_role, pk_menu, is_half)
        VALUES
        <foreach collection="menuRelDOS" item="menuRelDO" separator=",">
            ( #{pkRole}, #{menuRelDO.pkMenu}, #{menuRelDO.isHalf})
        </foreach>
    </insert>

    <delete id="deleteRoleApiByPkRole">
        delete from sys_role_api_rel
        WHERE pk_role IN
        <foreach collection="pkRoles" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <delete id="deleteRoleMenuByPkRole">
        delete from sys_role_menu_rel
        WHERE pk_role IN
        <foreach collection="pkRoles" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <select id="getApiPermissionsByPkRole" resultType="java.lang.Long">
        select pk_api from sys_role_api_rel where pk_role = #{id}
    </select>

    <select id="getMenuPermissionsByPkRole" resultType="com.neegix.system.role.infrastructure.repository.dataobject.RoleMenuRelDO">
        select pk_menu, is_half from sys_role_menu_rel where pk_role = #{id}
    </select>
</mapper>